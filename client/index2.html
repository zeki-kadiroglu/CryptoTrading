<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        #orderForm {
            display: none;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
        }
        #executeOrderButton,
        #registerButton,
        #loginButton {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #executeOrderButton {
            background-color: #28a745;
            color: white;
        }
        #registerButton,
        #loginButton {
            background-color: #007bff;
            color: white;
        }
        #executeOrderButton:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="registerButton">Register</button>
        <button id="loginButton">Login</button>

        

        <div id="orderForm">
            <div class="form-group">
                <label for="pairSelect">Select Pair:</label>
                <select id="pairSelect">
                    <option value="">-- Select a pair --</option>
                    <option value="BTC-USDT">BTC-USDT</option>
                    <option value="ETH-USDT">ETH-USDT</option>
                    <option value="XRP-USDT">XRP-USDT</option>
                    <option value="BCH-USDT">BCH-USDT</option>
                    <option value="LTC-USDT">LTC-USDT</option>
                </select>
            </div>
            <div class="form-group">
                <label for="price">Price:</label>
                <input type="number" id="price" placeholder="Enter price">
            </div>
            <div class="form-group">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" placeholder="Enter quantity">
            </div>
            <div class="form-group">
                <label for="action">Action:</label>
                <select id="action">
                    <option value="">-- Select action --</option>
                    <option value="buy">Buy</option>
                    <option value="sell">Sell</option>
                </select>
            </div>
            <button id="executeOrderButton" disabled>Execute Order</button>
        </div>
    </div>

    <script>
        let ws;

        document.getElementById('registerButton').addEventListener('click', function () {
            registerUser();
        });

        document.getElementById('loginButton').addEventListener('click', function () {
            loginUser();
        });

        function registerUser() {
            const username = prompt("Enter your username:");
            const password = prompt("Enter your password:");
            
            if (username && password) {
                fetch('http://localhost:8000/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password }),
                })
                .then(response => {
                    if (response.ok) {
                        alert('User registered successfully!');
                    } else {
                        throw new Error('Failed to register user');
                    }
                })
                .catch(error => {
                    console.error('Error registering user:', error);
                    alert('Error registering user. Please try again.');
                });
            } else {
                alert('Username and password are required.');
            }
        }

        function loginUser() {
            const username = prompt("Enter your username:");
            const password = prompt("Enter your password:");

            if (username && password) {
                fetch('http://localhost:8000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password }),
                })
                .then(response => {
                    if (response.ok) {
                        alert('User logged in successfully!');
                        document.getElementById('orderForm').style.display = 'block';
                    } else {
                        throw new Error('Failed to log in');
                    }
                })
                .catch(error => {
                    console.error('Error logging in:', error);
                    alert('Error logging in. Please try again.');
                });
            } else {
                alert('Username and password are required.');
            }
        }
        document.getElementById('executeOrderButton').addEventListener('click',

        function connectWebSocket() {
            const pair = document.getElementById('pairSelect').value;
            const price = document.getElementById('price').value;
            const quantity = document.getElementById('quantity').value;
            const action = document.getElementById('action').value;
            
            if (pair) {
                ws = new WebSocket(`ws://localhost:8000/ws/subscribe/${pair}`);
                ws.onopen = () => {
                    console.log(`Connected to WebSocket for ${pair}`);
                    ws.send(JSON.stringify({ pair, price, quantity, action }));
                    
                    };
                    
                    ws.onmessage = (event) => {
                        console.log('Message from server:', event.data);
                        alert('Order executed successfully!');
                    };
                    ws.onclose = () => {
                        console.log(`Disconnected from WebSocket for ${pair}`);
                    };
                } else {
                    if (ws) {
                        ws.close();
                    }
                }
            ;
        })

        const inputs = document.querySelectorAll('#price, #quantity, #action');
        inputs.forEach(input => input.addEventListener('input', checkFormValidity));

        function checkFormValidity() {
            const price = document.getElementById('price').value;
            const quantity = document.getElementById('quantity').value;
            const action = document.getElementById('action').value;
            const executeOrderButton = document.getElementById('executeOrderButton');
            executeOrderButton.disabled = !(price && quantity && action);
        }
        /*function checkOrderValidity() {
            
                const pair = document.getElementById('pairSelect').value;
                const price = document.getElementById('price').value;
                const quantity = document.getElementById('quantity').value;
                const action = document.getElementById('action').value;
    
                fetch('http://localhost:8000/execute_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ pair, price, quantity, action }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Order executed:', data);
                    
                    alert('Order executed successfully!');
                })
                .catch(error => {
                    console.error('Error executing order:', error);
                   
                });
            };*/
            
        

        
    </script>
</body>
</html>